load("/Volumes/nwr_publication/PNAS_edit/test_data/result/Read_Count.Rdata")
library(DNAcopy)
library(stringr)
expected_Read_In_Bin = sum(Read_In_Bin) * (Bin_Coordinate$end-Bin_Coordinate$start) / sum(Bin_Coordinate$end-Bin_Coordinate$start)
log_read_Norm = log2(Read_In_Bin/expected_Read_In_Bin)
chr_Num = match(Bin_Coordinate$chr,unique(Bin_Coordinate$chr))
arm = rep('q',nrow(Bin_Coordinate))
chr_Names = paste(str_pad(chr_Num,ceiling(log10(41)), pad = "0"),arm, sep = '_')
sample_name='test'
CNA.object <- CNA(cbind(log_read_Norm),
chr_Names,(Bin_Coordinate$start+Bin_Coordinate$end)/2,
data.type="logratio",sampleid=sample_name)
segment.smoothed.CNA.object <- segment(CNA.object, verbose=1)
CNV_segment_tmp = segment.smoothed.CNA.object
for (j in 1:nrow(CNV_segment_tmp)) {
segStart = CNV_segment_tmp[j,3];segEnd = CNV_segment_tmp[j,4]
which_CNV_loc = (! ( (CNA_result[,3] < segStart) | (segEnd < CNA_result[,2]) )) & (CNA_result[,1]==CNV_segment_tmp[j,2])
CNV_segment_tmp[j,3] = min(CNA_result$start[which_CNV_loc==T])
CNV_segment_tmp[j,4] = max(CNA_result$end[which_CNV_loc==T])
}
View(CNV_segment_tmp)
CNV_segment_tmp = segment.smoothed.CNA.object$output
CNV_segment_tmp = segment.smoothed.CNA.object$output
for (j in 1:nrow(CNV_segment_tmp)) {
segStart = CNV_segment_tmp[j,3];segEnd = CNV_segment_tmp[j,4]
which_CNV_loc = (! ( (CNA_result[,3] < segStart) | (segEnd < CNA_result[,2]) )) & (CNA_result[,1]==CNV_segment_tmp[j,2])
CNV_segment_tmp[j,3] = min(CNA_result$start[which_CNV_loc==T])
CNV_segment_tmp[j,4] = max(CNA_result$end[which_CNV_loc==T])
}
CNA_result = data.frame(chrom=CNA.object[,1],
start=Bin_Coordinate$start,
end=Bin_Coordinate$end,
value=CNA.object[,3])
CNV_segment_tmp = segment.smoothed.CNA.object$output
for (j in 1:nrow(CNV_segment_tmp)) {
segStart = CNV_segment_tmp[j,3];segEnd = CNV_segment_tmp[j,4]
which_CNV_loc = (! ( (CNA_result[,3] < segStart) | (segEnd < CNA_result[,2]) )) & (CNA_result[,1]==CNV_segment_tmp[j,2])
CNV_segment_tmp[j,3] = min(CNA_result$start[which_CNV_loc==T])
CNV_segment_tmp[j,4] = max(CNA_result$end[which_CNV_loc==T])
}
